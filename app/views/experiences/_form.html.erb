<%= form_for ([@trip, @experience]), :html => {:multipart => true} do |f| %>
<% unless @experience.errors.empty? %>
<script type="text/javascript">
  <% @experience.errors.full_messages.each do |msg| %>
  toastr.error('<%= msg %>')
  <% end %>
</script>
<% end %>

<div class="field">
  <%= f.label :title %><br>
  <%= f.text_field :title, required: true %>
</div>
<div class="field">
  <%= f.label :description %><br>
  <%= f.text_area :description, required: true %>
</div>

<div class="row">

  <div class="col-sm-6">
    <div class="field">
      <%= f.label :country %><br>
      <%= f.text_field :pais, required: true %>
    </div>
  </div>

  <div class="col-sm-6">
    <div class="field">
      <%= f.label :city %><br>
      <%= f.text_field :ciudad, required: true %>
    </div>
  </div>

</div>

<div class="field">
  <%= f.label :date %><br>
  <%= f.date_field :fecha, required: true %>
</div>


<hr>
<h3 class="center">Location</h3>

<div class="field">
  <%= f.label :last_registered_location %><br>
  <%= f.text_field :address, :readonly => true, id: "address", required: true %>
</div>
<p>INSTRUCTIONS:</p>
<p>1.- Search for the experience location (E.g. Monaco, Tazmania, Liverpool, etc.)</p> <br>
<p>2.- Drag the marker until the exact location</p> <br>
<div id="panel">
  <input id="city_country" type="textbox" value="(ENTER EXPERIENCE LOCATION...)" class="red">
  <input type="button" value="Search" onclick="codeAddress()" class="button button_red">
</div>  
<div id="mapCanvas"></div>
<div id="infoPanel">
  <b>Marker status:</b>
  <div id="markerStatus"><i>Click and drag the marker.</i></div>
</div>

<div class="field hidden">
  <%= f.label :latitude %><br>
  <%= f.text_field :latitude, id: "info1" %>
</div>
<div class="field hidden">
  <%= f.label :longitude %><br>
  <%= f.text_field :longitude, id: "info2" %>
</div>

<br><br>



<hr>
<h3 class="center">Especial Information</h3>

<br><br>
<h4>Experience's Senses</h4>

<div class="row">

  <div class="col-sm-2 col-sm-offset-1">
    <div class="field">
      <%= f.label :Sight %><br>
      <%= f.check_box :vista %>
    </div>
  </div>

  <div class="col-sm-2">
    <div class="field">
      <%= f.label :Smell %><br>
      <%= f.check_box :olfato %>
    </div>
  </div>

  <div class="col-sm-2">
    <div class="field">
      <%= f.label :Taste %><br>
      <%= f.check_box :gusto %>
    </div>
  </div>

  <div class="col-sm-2">
    <div class="field">
      <%= f.label :Hearing %><br>
      <%= f.check_box :oido %>
    </div>
  </div>

  <div class="col-sm-2">
    <div class="field">
      <%= f.label :Touch %><br>
      <%= f.check_box :tacto %>
    </div>
  </div>

</div>

<br><br>

<div class="row">
  <div class="col-sm-6">
    <div class="field">
      <%= f.label :What_kind_of_experience? %><br>
      <%= f.select :plan, [["Art & Design"], ["Nature"], ["Entertainment"], ["Sports"], ["Food & Drink"], ["Business"], ["Fun"]], {:prompt => 'Experience..'}, {:required => true}%>
    </div>
    
  </div>
  <div class="col-sm-6">

    <div class="field">
      <%= f.label :Ages %><br>
      <%= f.select :ages, [["EveryOne"], ["Kids"], ["Youth"], ["Grown Ups"]], {:prompt => 'Who will enjoy this experience?'}, {:required => true}%>
    </div>
    

  </div>
</div>





<div class="field">
  <%= f.label :Experience, 'How great was this experience? (1 - 10)' %><br>
  <%= f.range_field :expe, :min=>0, :max=>10, :class=>"slide", :id=>"slider1"%>
</div>


<div class="row">
  <div class="col-sm-6">
   <div class="field">
    <%= f.label :Language %><br>
    <%= f.text_field :idioma, required: true %>
  </div> 
</div>
<div class="col-sm-6">
  <div class="field">
    <%= f.label :Currency %><br>
    <%= f.text_field :currency, required: true %>
  </div>
</div>
</div>


<div class="row">
  <div class="col-sm-6">
   <div class="field">
    <%= f.label :drink %><br>
    <%= f.text_field :drink %>
  </div>
</div>
<div class="col-sm-6">
  <div class="field">
    <%= f.label :food %><br>
    <%= f.text_field :food %>
  </div>
</div>
</div>


<div class="row">
  <div class="col-sm-6">
    <div class="field">
      <%= f.label :How_much_money_I_need? %><br>
      <%= f.select :money, [["0 - 50 USD"], ["50 - 100 USD"], ["100 - 250 USD"], ["+ 250 USD"]], {:prompt => 'How much money?'}, {:required => true}%>
    </div>
  </div>
  <div class="col-sm-6">
    <div class="field">
      <%= f.label :Aprox_time %><br>
      <%= f.select :aprox_time, [["1 - 3 hours"], ["3 - 5 hours"], [" 5 - 12 hours"], ["+ 12 hours"]], {:prompt => 'How long the experience takes'}, {:required => true}%>
    </div>
  </div>
</div>


<div class="row">
  <div class="col-sm-6">
   <div class="field">
    <%= f.label :transportation %><br>
    <%= f.select :transportation, [["Train"], ["Bus"], ["Subway"], ["Car"], ["Taxi"], ["Bicycle"]], {:prompt => 'transportation..'}%>
  </div>
</div>
<div class="col-sm-6">
  <div class="field">
    <%= f.label :weather %><br>
    <%= f.select :weather, [["Rainy"], ["Sunny"], ["Cloudy"], ["Hot"], ["Cold"], ["Dry"], ["Windy"], ["Snow"], ["Wet"]], {:prompt => 'Kind of weather'}%>
  </div>
</div>
</div>

<div class="field">
  <%= f.label :People_warm, 'People Warm (1 - 10)' %><br>
  <%= f.range_field :gente, :min=>0, :max=>10, :class=>"slide", :id=>"slider1"%>
</div>

<br><br>
<div class="row">
  <div class="col-sm-4">
    <div class="field">
      <%= f.label :is_the_experience_risky? %><br>
      <%= f.check_box :is_risky %>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="field">
      <%= f.label :Does_it_have_internet_access? %><br>
      <%= f.check_box :is_internet %>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="field">
      <%= f.label :Need_reservation? %><br>
      <%= f.check_box :is_reservation %>
    </div>
  </div>
</div>


<div class="row">
  <div class="col-sm-4">
    <div class="field">
      <%= f.label :uber_available? %><br>
      <%= f.check_box :is_uber %>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="field">
      <%= f.label :Need_adapter? %><br>
      <%= f.check_box :is_adaptador %>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="field">
      <%= f.label :Need_visa? %><br>
      <%= f.check_box :need_visa %>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-sm-4">
    <div class="field">
      <%= f.label :Souvenirs? %><br>
      <%= f.check_box :is_souvenirs %>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="field">
      <%= f.label :Taxi_safe? %><br>
      <%= f.check_box :is_taxi_safe %>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="field">
      <%= f.label :Credit_card? %><br>
      <%= f.check_box :credit_card %>
    </div>
  </div>
</div>

<br><br>

<div class="field">
  <%= f.label :website %><br>
  <%= f.text_field :website %>
</div>

<div class="row">
  <div class="col-sm-4">
    <div class="field">
      <%= f.label :Tip %><br>
      <%= f.select :tip, [["0% - 5%"], ["6% - 9%"], ["10% - 12%"], ["12% - 15%"], ["+ 15%"]], {:prompt => 'How much tip'}%>
    </div>
  </div>
</div>

<div class="field">
  <%= f.label :advice %><br>
  <%= f.text_area :advice, required: true %>
</div>


<div class="row">
  <div class="col-md-4">
    <div class="form-group">              
      <span class="btn btn-default">
        <i class="fa fa-cloud-upload fa-lg"></i> Upload Photos 
        <%= file_field_tag "images[]", type: :file, multiple: true %>
      </span>
    </div>    
  </div>
</div>

<div id="photos"><%= render 'photos/list' %></div>






<div class="actions">
  <%= f.submit class: "button button_red button_block" %>
</div>
<% end %>

<br>

<script type="text/javascript"> 

  var geocoder;
  var map;
  var marker;

  codeAddress = function () {
    geocoder = new google.maps.Geocoder();

    var address = document.getElementById('city_country').value;
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map = new google.maps.Map(document.getElementById('mapCanvas'), {
          zoom: 16,
          streetViewControl: false,
          mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
            mapTypeIds:[google.maps.MapTypeId.HYBRID, google.maps.MapTypeId.ROADMAP] 
          },
          center: results[0].geometry.location,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        map.setCenter(results[0].geometry.location);
        marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location,
          draggable: true,
          title: 'My Title'
        });
        updateMarkerPosition(results[0].geometry.location);
        geocodePosition(results[0].geometry.location);
        
      // Add dragging event listeners.
      google.maps.event.addListener(marker, 'dragstart', function() {
        updateMarkerAddress('Dragging...');
      });
      
      google.maps.event.addListener(marker, 'drag', function() {
        updateMarkerStatus('Dragging...');
        updateMarkerPosition(marker.getPosition());
      });

      google.maps.event.addListener(marker, 'dragend', function() {
        updateMarkerStatus('Drag ended');
        geocodePosition(marker.getPosition());
        map.panTo(marker.getPosition()); 
      });

      google.maps.event.addListener(map, 'click', function(e) {
        updateMarkerPosition(e.latLng);
        geocodePosition(marker.getPosition());
        marker.setPosition(e.latLng);
        map.panTo(marker.getPosition()); 
      }); 

    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });
  }

  function geocodePosition(pos) {
    geocoder.geocode({
      latLng: pos
    }, function(responses) {
      if (responses && responses.length > 0) {
        updateMarkerAddress(responses[0].formatted_address);
      } else {
        updateMarkerAddress('Cannot determine address at this location.');
      }
    });
  }

  function updateMarkerStatus(str) {
    document.getElementById('markerStatus').innerHTML = str;
  }

  function updateMarkerPosition(latLng) {
    document.getElementById('info1').value = [
    latLng.lat()
    ];
  }

  function updateMarkerPosition2(latLng) {
    document.getElementById('info2').value = [
    latLng.lng()
    ];
  }

  function updateMarkerAddress(str) {
    document.getElementById('address').value = str;
  }


  function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    infoWindow.setPosition(pos);
    infoWindow.setContent(browserHasGeolocation ?
      'Error: The Geolocation service failed.' :
      'Error: Your browser doesn\'t support geolocation.');
    infoWindow.open(map);
  }

</script>



<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA70HYo_A20eeT6Ye7-b0XL-chKMuwJHyc&callback=initMap"
async defer></script>

